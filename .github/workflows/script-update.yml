name: Deploy Script to BigCommerce

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14'

      - name: Install dependencies
        run: npm install

      - name: Deploy script to BigCommerce
        env:
          BC_STORE_HASH: ${{ secrets.STORE_HASH }}
          BC_ACCESS_TOKEN: ${{ secrets.SCRIPT_ACCESS_TOKEN }}
          SCRIPT_UUID: ${{ secrets.SCRIPT_UUID }}
        run: |
          curl -X PUT \
          https://api.bigcommerce.com/stores/${{ secrets.STORE_HASH }}/v3/content/scripts/${{ secrets.SCRIPT_UUID }} \
          -H "X-Auth-Token: ${{ secrets.SCRIPT_ACCESS_TOKEN }}" \
          -H "Content-Type: application/json" \
          -d '{
            "name": "Bootstrapscript",
            "description": "Build responsive websites script",
            "html": "'"$(cat scripts/bootstrapscript.html)"'",
            "auto_uninstall": true,
            "load_method": "default",
            "location": "footer",
            "visibility": "all_pages",
            "kind": "script_tag",
            "consent_category": "essential"
            }'
